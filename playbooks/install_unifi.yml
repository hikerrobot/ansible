# based upon https://pimylifeup.com/rasberry-pi-unifi/
- name: pi unifi setup
  hosts: 10.1.10.36
  remote_user: pi
  become_user: root
  become: true
  tasks:
    - name: update apt
      apt:
        update_cache: true
    # *** jdk only available on 32 bit os ***
    # unifi only supports java 8 when making this!!
    - name: install jdk 8 rng-tools
      apt:
        update_cache: true
        pkg:
        - openjdk-8-jre-headless
        - rng-tools
        state: latest
    # nb. file name differs from expected, which was /etc/default/rng-tools-debian 
    - name: replace content in /etc/default/rng-tools
      ansible.builtin.replace:
        path: /etc/default/rng-tools
        regexp: '#HRNGDEVICE=\/dev\/hwrng'
        replace: 'HRNGDEVICE=\/dev/hwrng\/'
    - name: restart service rng-tools
      ansible.builtin.service:
        name: rng-tools
        state: restarted
    # - name: replace file  /etc/apt/preferences.d/99stretch-mongodb.pref
    #   ansible.builtin.copy:
    #     src: pi-files/99stretch-mongodb.pref
    #     dest:  /etc/apt/preferences.d/
    # - name: replace content in /etc/default/rng-tools-debian
    #   ansible.builtin.shell:


        # echo "deb http://archive.raspbian.org/raspbian stretch main" | sudo tee /etc/apt/sources.list.d/stretch_mongodb.list

